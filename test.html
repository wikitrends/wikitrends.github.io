<html><head><meta charset="utf-8">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300" rel="stylesheet" type="text/css">
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,900" rel="stylesheet" type="text/css">
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <link href="style.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js"></script>

<style>
.upperline {
    fill: #3FC380;
    stroke: none;
    stroke-width: 1px;
}

.bottomline {
    fill: #E26A6A;
    stroke: none;
    stroke-width: 1px;
}

#two {
    margin-bottom: 100px;
}

#three {
    margin-bottom: 100px;
}
</style></head>


<body>
    <div class="col-md-12">
        <h1>Bar Chart</h1>
        <div class="col-md-9">
            <div style="  margin-left: 60px; margin-top: 20px" class="BarChartInput">
                <ul style="display: inline-block;" class="nav nav-pills" id="BarChartSelector">
                    <!--

                    <li>
                        <label>
                            <input type="radio" name="typeBarChart" value="WeeklyAvgEvaluationTime">WeeklyAvgEvaluationTime</label>
                    </li>
                    <li>
                        <label style="background-color : #428bca; color : #fff">
                            <input type="radio" name="typeBarChart" value="WeeklyVulns">WeeklyVulns</label>
                    </li>
                    <li>
                        <label>
                            <input type="radio" name="typeBarChart" value="WeeklyImpressions">WeeklyImpressions</label>
                    </li>
                    <li>
                        <label>
                            <input type="radio" name="typeBarChart" value="AvgEvaluationTime">AvgEvaluationTime</label>
                    </li>

                    -->
                </ul>
            </div>
        </div>
        <div style="margin-bottom: 50px;" id="barone"></div>
    </div>
    <div class="col-md-12">
        <h1>Line Chart</h1>
        <div class="col-md-9">
            <div style="  margin-left: 60px; margin-top: 20px;" class="BarChartInput">
                <ul style="display: inline-block;" class="nav nav-pills" id="LineChartSelector">
                    <!--<li>
                        <label>
                            <input type="radio" name="typeLineChart" value="WeeklyAvgEvaluationTime">WeeklyAvgEvaluationTime</label>
                    </li>
                    
                    <li>
                        <label style="background-color : #428bca; color : #fff">
                            <input type="radio" name="typeLineChart" value="WeeklyVulns">WeeklyVulns</label>
                    </li>
                    <li>
                        <label>
                            <input type="radio" name="typeLineChart" value="WeeklyImpressions">WeeklyImpressions</label>
                    </li>
                    <li>
                        <label>
                            <input type="radio" name="typeLineChart" value="AvgEvaluationTime">AvgEvaluationTime</label>
                    </li>-->
                </ul>
            </div>
        </div>
        <div style="margin-bottom: 50px;" id="lineone"></div>
    </div>

<script src="http://d3js.org/d3.v3.js"></script>
<script>

var today = new Date();

//alert(typeof today);


var previousDate = new Date(new Date().setDate(new Date().getDate()-182))
var dd = previousDate.getDate();
var mm = previousDate.getMonth()+1; //January is 0!
var yyyy = previousDate.getFullYear();

if(dd<10) {
    dd='0'+dd
} 
if(mm<10) {
    mm='0'+mm
}
previousDate = mm+'/'+dd+'/'+yyyy;
//alert(previousDate);



d3.json("test.json", function(error, data) {

    function barChart(type) {

        var count;
        var parseDate = d3.time.format("%Y-%m-%dT%H:%M:%S.%LZ").parse;

        console.log(data)

        // data.forEach(function(d, i) {
        //     count = i
        //     // d[type] = parseInt(d[type])
        // })

        var maxHeight = d3.max(data, function(d) {
            // console.log(d[type])
            return d.values
        })

        console.log(maxHeight)

        var minHeight = d3.min(data, function(d) {
            return d.values
        });

        var max = count;
        var min = 0;

        var margin = {
                top: 40,
                right: 20,
                bottom: 30,
                left: 40
            },
            width = 860 - margin.left - margin.right,
            height = 250 - margin.top - margin.bottom;

        var x = d3.time.scale()
            .range([0, width]);

        x.domain(d3.extent(data, function(d) {
            console.log(d.key)
            return parseDate(d.key)
        }))
var a = moment(x.domain()[1]);
var b = moment(x.domain()[0]);

var difference = a.diff(b, 'hours')

        // console.log(x.domain()[0])

        // var xAxis = d3.svg.axis()
        //     .scale(x)
        //     .ticks(4)
        //     .tickPadding(8)
        //     .tickSize(0)
        //     .innerTickSize(0)
        //     .outerTickSize(0)
        //     // .tickSize(6, 0)
        //     .orient("bottom");

        var y = d3.scale.linear()
            .range([height, 0]);

        /*
                function parseDate(str) {
                    var mdy = str.split('/')
                    return new Date(mdy[2], mdy[0] - 1, mdy[1]);
                }
                function daydiff(first, second) {
                    return (second - first) / (1000 * 60 * 60 * 24);
                }
                alert(daydiff(parseDate($('#first').val()), parseDate($('#second').val())));
        */

        // var z = d3.time.scale()
        //     .domain([new Date(previousDate), new Date()])
        //     .range([0, width]);

        //var parseDate = d3.time.format.utc("%Y-%m-%dT%H:%M:%SZ").parse;


        var xAxis = d3.svg.axis()
            // .ticks(d3.time.month, 15)
            //.tickValues(["April", 2, 3, 5, 8, 13, 21])
            .scale(x)
            .ticks(5)
            .orient("bottom");

        var yAxis = d3.svg.axis()
            .scale(y)
            .ticks(10)
            .orient("left");


        var svg = d3.select("body").select("#barone").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


        // x.domain([min, max]);
        y.domain([minHeight - 0.08, maxHeight]);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis)
            .append("text")
            .attr("transform", "rotate(0)")
            .attr("x", width)
            .attr("dy", "-0.71em")
            .style("text-anchor", "end")
            .text(function() {
                return "Week"
            });

        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text(function() {
                // if (type == "WeeklyAvgEvaluationTime") {
                //     return "Evaluations"
                // } else if (type == "WeeklyVulns") {
                //     return "Vulnerabilities"
                // } else if (type == "WeeklyImpressions") {
                //     return "Impressions"
                // } else if (type == "AvgEvaluationTime") {
                    return "Eval Time"
                // }
            });

        svg.selectAll(".bar")
            .data(data)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", function(d, i) {

                // console.log(d.key)
                // console.log(parseDate(d.key))
                // console.log(x(parseDate(d.key)))

                return x(parseDate(d.key))

            })
            .attr("width", function() {
                var barWidth = width / difference 
                if ( barWidth < 5 ) {
                    return 3
                }
                 return ( width / difference ) 
                return (width - 100) / count
            })
            .attr("y", function(d) {
                return y(d.values)
            })
            .attr("height", function(d) {

                return height - y(d.values)

            })
            .attr("opacity", function(d) {
                return 1
            })
            .attr("fill", function(d) {
                // if (type == "WeeklyAvgEvaluationTime") {
                //     return "#3498db"
                // } else if (type == "WeeklyVulns") {
                //     return "#e74c3c"
                // } else if (type == "WeeklyImpressions") {
                //     return "#f1c40f"
                // } else if (type == "AvgEvaluationTime") {
                    return "#2ecc71"
                // }

            })

    }

    barChart("WeeklyAvgEvaluationTime")

/*
    function BarChange() {


        var radios = document.getElementsByName('typeBarChart');

        for (var i = 0, length = radios.length; i < length; i++) {
            if (radios[i].checked) {
                svgBarsRemove()
                barChart(
                    radios[i].value);
                console.log(radios[i].value)
                break;
            }
        }

    }




    function svgBarsRemove() {
        d3.select("body").select("#barone").select("svg").remove()
    }


    d3.select("#BarChartSelector").selectAll("input")
        .on("change", BarChange);
*/

})
</script>

</body></html>